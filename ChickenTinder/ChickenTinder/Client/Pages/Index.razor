@page "/"
@using ChickenTinder.Client.Data
@inject NavigationManager nav
@inject ServerConnection _server;

@if (!_isLoading)
{
    <div class="center-all">
        <img src="/icon-192.png" style="margin-top: 20px" />
    </div>
    <h1 class="center-all" style="margin-top: 50px">Chicken Tinder</h1>
    <p class="center-all">Find Single Restaurants Near You</p>

    <div class="footer">
        <div class="center-all">
            <p style="margin: 0px">Host or Enter Code</p>
        </div>
        <div class="center-all">
            <input class="textbox" type="number" placeholder="Code" value="@Code" @oninput="e => Code = e.Value?.ToString()" />
        </div>
        <div class="center-bottom">
            <button class="btn" @onclick="Join">@JoinText</button>

        </div>
    </div>
}
else
{
    <div id="spinner">
        <img src="/icon-192.png" />
    </div>
}


@code {
    private bool _isLoading = false;
    private string? _code;
    public string? Code
    {
        get => _code; set
        {

            if (!string.IsNullOrWhiteSpace(value))
            {
                JoinText = "Join";
            }
            else
            {
                JoinText = "Host";
            }
            _code = value;
        }
    }
    public string JoinText { get; set; } = "Host";

    public async void Join()
    {
        _isLoading = true;
        StateHasChanged();

        if (string.IsNullOrWhiteSpace(Code))
        {
            await _server.CreateRoom();
        }
        else
        {
            await _server.JoinRoom(int.Parse(Code));
        }
        _isLoading = false;
        StateHasChanged();

        //create the room...
        nav.NavigateTo("/room");
    }
}
